{% extends 'courses/base.html' %}

{% block title %}
{{ course.course_title }} - Lectures
{% endblock %}

{% block content %}
<style>
    /* Sidebar styling to match the second template */
    .sidebar {
        height: 100vh;
        width: 200px;
        position: fixed;
        top: 52px; /* Adjust top to match the header */
        left: 0;
        background-color: #343a40;
        padding-top: 20px;
        overflow-y: auto;
    }

    .sidebar ul.components li a {
        color: #adb5bd;
        padding: 10px 15px;
        display: block;
        text-decoration: none;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }

    .sidebar ul.components li a:hover {
        background-color: #495057;
        color: #fff;
    }

    /* Main Content Styling */
    .lecture-content {
        margin-left: 20px;  /* Reduced spacing from sidebar */
        padding: 40px 60px;
        min-height: calc(100vh - 52px); /* Full height minus top header */
        background-color: #f9f9fb;
    }

    .lecture-content h2 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #0f2d4b;
        margin-bottom: 20px;
    }

    .lecture-description {
        font-size: 1.2rem;
        color: #333;
        line-height: 1.8;
    }

    .lecture-video iframe {
        border-radius: 8px;
        border: 1px solid #ddd;
    }

    /* Styling the comment form */
    .comment-form textarea {
        width: 100%;
        padding: 10px;
        font-size: 1rem;
        border-radius: 5px;
        border: 1px solid #ddd;
    }

    .comment-form button {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .comment-form button:hover {
        background-color: #0056b3;
    }

    /* Comment Styling */
    .comment {
        background-color: #f9f9f9;
        border-radius: 5px;
        border: 1px solid #ddd;
        margin-bottom: 20px;
        padding: 15px;
    }

    /* Styling for the comments section */
    .comments-section h3 {
        font-size: 1.5rem;
        color: #333;
        font-weight: bold;
    }

    .comment .delete-btn {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        font-size: 0.9rem;
        cursor: pointer;
        border-radius: 5px;
        float: right;
    }

    .comment .delete-btn:hover {
        background-color: #c82333;
    }
</style>

<div class="container-fluid mt-5" style="display: flex; padding-left: 200px;"> <!-- Adjust for sidebar width -->

    <!-- Sidebar for Lectures -->
    <sidebar class="sidebar">
        <ul class="list-unstyled components">
            {% for lecture in lectures %}
                <li class="{% if lecture == lecture_selected %}active{% endif %}">
                    <a href="{% url 'lecture_selected' course.course_slug lecture.lecture_slug %}">
                        {{ lecture.lecture_title }}
                    </a>
                </li>
            {% empty %}
                <li>No lectures available.</li>
            {% endfor %}
        </ul>
    </sidebar>

    <!-- Main content area -->
    <div class="lecture-content">
        <h2>{{ lecture_selected.lecture_title }}</h2>
        <p class="lecture-description">{{ lecture_selected.lecture_description }}</p>

        {% if lecture_selected.lecture_video %}
        <div class="mt-4 lecture-video">
            <iframe width="100%" height="400" src="https://www.youtube.com/embed/{{ lecture_selected.lecture_video }}" frameborder="0" allowfullscreen></iframe>
        </div>
        {% endif %}


        <!-- Mark as Completed Button -->

{% if user.is_authenticated %}
  {% if lecture_selected.id in completed_lecture_ids %}
    <div class="alert alert-success mt-3">
      âœ… You've completed this lecture!
    </div>
  {% else %}
    <form method="post" action="{% url 'mark_lecture_complete' course.course_slug lecture_selected.lecture_slug %}" class="mt-3">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary">
        Mark as Completed
      </button>
    </form>
  {% endif %}
{% endif %}


        <!-- Comments Section -->
        <div class="comments-section mt-5">
            <h3>Comments</h3>

            <!-- Comment Form -->
            <form method="POST" class="comment-form" action="{% url 'lecture_selected' course.course_slug lecture_selected.lecture_slug %}">
                {% csrf_token %}
                <textarea name="comment" id="comment-text" class="form-control" placeholder="Add your comment..." rows="4"></textarea><br>
                <button type="submit" class="btn btn-primary">Submit Comment</button>
            </form>

            <!-- Display Comments -->
            <div class="comments-list mt-4" id="comments-list">
                {% for comment in comments %}
                <div class="comment mb-3 p-3" style="background-color: #f9f9f9; border-radius: 5px; border: 1px solid #ddd;">
                    <strong>{{ comment.user.username }}</strong>
                    <p>{{ comment.text }}</p>
                    <!-- Delete Button only visible for the user who created the comment -->
                    {% if comment.user == request.user %}
                        <form method="POST" action="{% url 'delete_comment' comment.id %}">{% csrf_token %}
                            <button type="submit" class="delete-btn">Delete</button>
                        </form>
                    {% endif %}
                </div>
                {% empty %}
                <p>No comments yet. Be the first to comment!</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

